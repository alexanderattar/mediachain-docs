<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width">

        <title>Mediachain : Getting Started</title>
        <meta name="description" content="Docs for the Mediachain Project">

        <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="/css/syntax.css">
        <link rel="stylesheet" href="/css/main.css">
        <link rel="shortcut icon" type="image/png" href="/favicon.png"/>
        <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
    </head>
    <body>

        <div class="container">
            <div class="row">
                <div id="header" class="col-sm-12">
                    <h4><a class="brand" href="/">Mediachain</a>
    <small>Docs for the Mediachain Project</small>
</h4>

                </div>
            </div>

            <div class="row">
                <div id="navigation" class="col-sm-3">
                    <ul class="nav nav-list">
    
      
      
      <h4>Installation and Setup</h4>
      
      
        <li>
          <a href="/install">Installing Mediachain</a>
          
        </li>
      
        <li>
          <a href="/cloud-deploy">Using Mediachain Deploy</a>
          
        </li>
      
        <li>
          <a href="/getting-started">Getting Started</a>
          
            <div id="nav_current"></div>
          
        </li>
      
        <li>
          <a href="/nat">Configuring NAT Traversal</a>
          
        </li>
      
        <li>
          <a href="/ssh-tunnel">Controlling a remote node with SSH Tunneling</a>
          
        </li>
      
    
<!-- List additional links. It is recommended to add a divider
    e.g. <li class="divider"></li> first to break up the content. -->
</ul>

                </div>

                <div id="content" class="col-sm-9">
                    <div class="page-header">
    <h1>Getting Started
        
    </h1>
</div>

<ul id="table_of_contents">
  <li><a href="#first-steps">First steps</a>    <ul>
      <li><a href="#starting-a-new-node">Starting a new node</a></li>
      <li><a href="#bringing-the-node-online">Bringing the node online</a></li>
      <li><a href="#configuring-the-directory">Configuring the directory</a></li>
      <li><a href="#taking-the-node-online">Taking the node online</a></li>
    </ul>
  </li>
  <li><a href="#basic-operations">Basic Operations</a>    <ul>
      <li><a href="#query">Query</a></li>
      <li><a href="#merge">Merge</a></li>
      <li><a href="#publishing-statements">Publishing Statements</a></li>
    </ul>
  </li>
  <li><a href="#going-public">Going Public</a></li>
</ul>

<p>Welcome to Mediachain! This guide will help you get started with a newly-installed mediachain node.
For help with installation, please check out the <a href="/install">Installation Guide</a>, then come back
here.</p>

<p>This guide will assume that you’ve installed <code>mcnode</code> and <code>mcclient</code> on your local computer, and
you want to publish some data and make it available to the public.  If you’ve <a href="/cloud-deploy">deployed your node
to the cloud</a>, everything will work just the same, but you’ll need to
<a href="/ssh-tunnel">set up an SSH tunnel to control your node</a>.</p>

<h2 id="first-steps">First steps</h2>

<h3 id="starting-a-new-node">Starting a new node</h3>
<p>Let’s start our node!</p>

<p>You can run your local mediachain node by invoking <code>mcnode</code> without arguments:</p>

<pre><code>$ mcnode
2016/10/20 19:29:24 Generating new node identity
2016/10/20 19:29:25 Saving key to /home/vyzo/.mediachain/mcnode/identity.node
2016/10/20 19:29:25 Node ID: QmeBkfxcaBfA9pvzivRwhF2PM7sXpp4HHQbp7jfTkRCWEa
2016/10/20 19:29:25 Generating new publisher identity
2016/10/20 19:29:25 Saving key to /home/vyzo/.mediachain/mcnode/identity.publisher
2016/10/20 19:29:25 Publisher ID: 4XTTMADSKQUN3jkeZngbtuE35w9y5YnDTicVTeeji7N2Npkey
2016/10/20 19:29:25 Node is offline
2016/10/20 19:29:25 Serving client interface at 127.0.0.1:9002
</code></pre>

<p>The first time you run <code>mcnode</code>, it will generate a pair of persistent identities and
initialize the local store. By default, <code>mcnode</code> uses <code>~/.mediachain/mcnode</code> as its
root directory, but you can change this using the <code>-d path/to/mcnode/home</code> command line option.</p>

<h3 id="bringing-the-node-online">Bringing the node online</h3>
<p>By default, the node starts disconnected from the p2p network and provides a client control
api in localhost.
You can control and use your node through the api using curl, but it is recommended
to <a href="/install#installing-aleph">install Aleph</a>.
Aleph provides a fully featured client for <code>mcnode</code> named <code>mcclient</code> and we use it in
the examples below.</p>

<p>Once your node is up and running you can check its status:</p>

<pre><code>$ mcclient id
Peer ID: QmeBkfxcaBfA9pvzivRwhF2PM7sXpp4HHQbp7jfTkRCWEa
Publisher ID: 4XTTMADSKQUN3jkeZngbtuE35w9y5YnDTicVTeeji7N2Npkey
Info:
$ mcclient status
offline
</code></pre>

<p>Since our status is <code>offline</code>, we can’t reach other peers, and attempting to do so will
result in an error:</p>

<pre><code>$ mcclient listPeers
Internal Server Error
Error: Node is offline
</code></pre>

<p>Let’s fix that by setting a directory server and taking our node online.</p>

<h3 id="configuring-the-directory">Configuring the directory</h3>
<p>At this point you should designate a directory for looking up peers.  We’ll use the
<a href="https://github.com/multiformats/multiaddr">multiaddress</a> of the Mediachain Labs public directory,
<code>/ip4/52.7.126.237/tcp/9000/p2p/QmSdJVceFki4rDbcSrW7JTJZgU9so25Ko7oKHE97mGmkU6</code>.</p>

<pre><code>$ mcclient config dir /ip4/52.7.126.237/tcp/9000/p2p/QmSdJVceFki4rDbcSrW7JTJZgU9so25Ko7oKHE97mGmkU6
set directory to /ip4/52.7.126.237/tcp/9000/p2p/QmSdJVceFki4rDbcSrW7JTJZgU9so25Ko7oKHE97mGmkU6
</code></pre>

<p>The directory allows you to contact other nodes that have registered themselves by setting
their status to <code>public</code>.  When contacting a remote node, we use their Peer ID, which is an
encoded <a href="https://github.com/multiformats/multihash">multihash</a> that’s derived from the node’s public key.  The directory
maps Peer IDs to routable addresses that our node can use to connect to others.</p>

<p>Setting the directory does not make your node visible to others; for that we need to set our
status to <code>public</code>.  We’ll do that in a little while; first lets take our node online so that
it can query the directory and contact other peers.</p>

<h3 id="taking-the-node-online">Taking the node online</h3>
<p>Set the node’s status to <code>online</code>:</p>

<pre><code>$ mcclient status online
status set to online
</code></pre>

<p>Now we can query the directory for the list of registered peers:</p>

<pre><code>$ mcclient listPeers
...
QmeiY2eHMwK92Zt6X4kUUC3MsjMmVb2VnGZ17DhnhRPCEQ
...
</code></pre>

<p>And learn more about them:</p>

<pre><code>$ mcclient id QmeiY2eHMwK92Zt6X4kUUC3MsjMmVb2VnGZ17DhnhRPCEQ
Peer ID: QmeiY2eHMwK92Zt6X4kUUC3MsjMmVb2VnGZ17DhnhRPCEQ
Publisher ID: 4XTTM4K8sqTb7xYviJJcRDJ5W6TpQxMoJ7GtBstTALgh5wzGm
Info: Metadata for CC images from DPLA, 500px, and pexels; operated by Mediachain Labs.
</code></pre>

<p>We can also get the <code>Info</code> string alongside the directory listing with <code>mcclient listPeers --info</code>:</p>

<pre><code>$ mcclient listPeers --info
QmTVsocFCSEdPyM8dZ734GRhjvvmYyL9fShyezVkbPj17E -- Curated Museum Metadata; Operated by Mediachain Labs
QmeiY2eHMwK92Zt6X4kUUC3MsjMmVb2VnGZ17DhnhRPCEQ -- Metadata for CC images from DPLA, 500px, and pexels; operated by Mediachain Labs.
QmZ6dckUhRouVr6AsBTpK6vMLVpcz1KAeJAJVQEZQ5gCek -- Metadata for CC images from flickr; operated by Mediachain Labs.
...
</code></pre>

<h2 id="basic-operations">Basic Operations</h2>
<p>The basic mediachain operations are queries, local or remote,  and merges of remote datasets.</p>

<h3 id="query">Query</h3>
<p>Here, we query the namespaces for statements in the discovered peer’s datastore and take a small
sample from the <code>images.dpla</code> namespace:</p>

<pre><code>$ mcclient query -r QmeiY2eHMwK92Zt6X4kUUC3MsjMmVb2VnGZ17DhnhRPCEQ "SELECT namespace FROM *"
'images.500px'
'images.dpla'
'images.pexels'

$ mcclient query -r QmeiY2eHMwK92Zt6X4kUUC3MsjMmVb2VnGZ17DhnhRPCEQ "SELECT COUNT(*) FROM images.dpla"
3738109

$ mcclient query -r QmeiY2eHMwK92Zt6X4kUUC3MsjMmVb2VnGZ17DhnhRPCEQ "SELECT * FROM images.dpla LIMIT 5"
{ id: '4XTTM4K8sqTb7xYviJJcRDJ5W6TpQxMoJ7GtBstTALgh5wzGm:1476970964:0',
  publisher: '4XTTM4K8sqTb7xYviJJcRDJ5W6TpQxMoJ7GtBstTALgh5wzGm',
  namespace: 'images.dpla',
  body:
   { Body:
      { Simple:
         { object: 'Qma1LUdw5PAjfuZLXCbT5Qm5xnQFLkEejyXbLuvcKinF8K',
           refs: [ 'dpla_1349ede833fa9417b6f55be6bb402f6d' ] } } },
  timestamp: 1476970964,
  signature: 'mZMSMdMrahd40uyJChHAFLMvB5diR8qh9QI2kw0XUR7HxTo6sh2jtCzHZVBaKnOa7w9QkSrPdEU8qqfAsBEiDA==' }
...  
</code></pre>

<h3 id="merge">Merge</h3>
<p>We can merge remote datasets using a query; the node will merge in
the statements selected by the query and associated metadata:</p>

<pre><code>$ mcclient merge QmeiY2eHMwK92Zt6X4kUUC3MsjMmVb2VnGZ17DhnhRPCEQ "SELECT * FROM images.dpla LIMIT 5"
merged 5 statements and 5 objects
</code></pre>

<p>The statements and the associated metadata our now stored in the local node:</p>

<pre><code>$ mcclient query "SELECT * FROM images.dpla"
{ id: '4XTTM4K8sqTb7xYviJJcRDJ5W6TpQxMoJ7GtBstTALgh5wzGm:1476970964:0',
  publisher: '4XTTM4K8sqTb7xYviJJcRDJ5W6TpQxMoJ7GtBstTALgh5wzGm',
  namespace: 'images.dpla',
  body:
   { Body:
      { Simple:
         { object: 'Qma1LUdw5PAjfuZLXCbT5Qm5xnQFLkEejyXbLuvcKinF8K',
           refs: [ 'dpla_1349ede833fa9417b6f55be6bb402f6d' ] } } },
  timestamp: 1476970964,
  signature: 'mZMSMdMrahd40uyJChHAFLMvB5diR8qh9QI2kw0XUR7HxTo6sh2jtCzHZVBaKnOa7w9QkSrPdEU8qqfAsBEiDA==' }
...

The following `getData` command is targeting our local node, not the remote peer.  Since the
`object` (referenced in the statement above) was successfully merged in, we get the data we want:

$ mcclient getData Qma1LUdw5PAjfuZLXCbT5Qm5xnQFLkEejyXbLuvcKinF8K
{ orientation: null,
  dedupe_hsh: '4e0783f1e8f41bac',
  licenses: [ { details: null } ],
  native_id: 'dpla_http://dp.la/api/items/1349ede833fa9417b6f55be6bb402f6d',
  keywords: [],
  date_created_original: null,
  title: [ 'Page 91' ],
  camera_exif: {},
  source: { url: 'https://dp.la/', name: 'dpla' },
  transient_info: { score_hotnessviews: null, likes: null },
  date_captured: null,
  location: { lat_lon: null, place_name: [] },
  attribution: null,
  description: 'kada',
  source_tags: [ 'dp.la' ],
  date_created_at_source: null,
  providers_list:
   [ { name: 'dpla' },
     { name: 'University of Southern California. Libraries' } ],
  date_source_version: null,
  sizes:
   [ { bytes: null,
       height: 120,
       uri_external: 'http://digitallibrary.usc.edu/utils/getthumbnail/collection/p15799coll126/id/7763',
       width: 66,
       content_type: 'image/jpeg',
       dpi: null } ],
  source_dataset: 'dpla',
  artist_names: [],
  url_direct: { url: 'http://digitallibrary.usc.edu/utils/getthumbnail/collection/p15799coll126/id/7763' },
  derived_qualities:
   { medium: null,
     predicted_tags: null,
     has_people: null,
     colors: null,
     general_type: null,
     time_period: null },
  url_shown_at: { url: 'http://digitallibrary.usc.edu/cdm/ref/collection/p15799coll126/id/7763' },
  aspect_ratio: 0.55 }

</code></pre>

<p>If you decide you no longer want to keep the statements you merged in your local store,
you can delete them:</p>

<pre><code>$ mcclient delete "DELETE FROM images.dpla"
Deleted 5 statements
</code></pre>

<h3 id="publishing-statements">Publishing Statements</h3>

<p>You can publish statements to your local node by creating json objects with the metadata
you want to publish.</p>

<p>For example, let’s publish hello world in a couple different variations:</p>

<pre><code>$ cat /tmp/hello.json
{"id": "hello_1", "hello": "world"}
{"id": "hello_2", "hola": "mundo"}
$ mcclient publish --idFilter '.id' scratch.hello /tmp/hello.json
statement id: 4XTTMADSKQUN3jkeZngbtuE35w9y5YnDTicVTeeji7N2Npkey:1477063161:0 -- body: QmZDxgNgUT1J3rgjvnGjoxoA5efGNSN9Qvhq4FpvefmwnA -- refs: ["hello_1"]
statement id: 4XTTMADSKQUN3jkeZngbtuE35w9y5YnDTicVTeeji7N2Npkey:1477063161:1 -- body: QmcdACgobENfs7vuD2CpQGi8RdEkNyAmbmyqVvrA7Z57xu -- refs: ["hello_2"]
All statements published successfully
</code></pre>

<p>The statements and the metadata are now stored by the local node:</p>

<pre><code>$ mcclient query 'SELECT * FROM scratch.hello'
{ id: '4XTTMADSKQUN3jkeZngbtuE35w9y5YnDTicVTeeji7N2Npkey:1477063161:0',
  publisher: '4XTTMADSKQUN3jkeZngbtuE35w9y5YnDTicVTeeji7N2Npkey',
  namespace: 'scratch.hello',
  body:
   { Body:
      { Simple:
         { object: 'QmZDxgNgUT1J3rgjvnGjoxoA5efGNSN9Qvhq4FpvefmwnA',
           refs: [ 'hello_1' ] } } },
  timestamp: 1477063161,
  signature: 'Q79Vgp7bl4J7rJo3DOmtueLGqHQpG3lpSyiXbTqX60oOdbPdju06m4epiQNrGLarfCsj2Opa0psX6EWm6BJkDw==' }
{ id: '4XTTMADSKQUN3jkeZngbtuE35w9y5YnDTicVTeeji7N2Npkey:1477063161:1',
  publisher: '4XTTMADSKQUN3jkeZngbtuE35w9y5YnDTicVTeeji7N2Npkey',
  namespace: 'scratch.hello',
  body:
   { Body:
      { Simple:
         { object: 'QmcdACgobENfs7vuD2CpQGi8RdEkNyAmbmyqVvrA7Z57xu',
           refs: [ 'hello_2' ] } } },
  timestamp: 1477063161,
  signature: 'bN7mAW3JKJAHtInSGM08IXoUx//qFJpySaCWPEe8P6Pm46XxoOrepG2Q2KrIQ5bs5oLKJkU7qHqFI2dQaHETCQ==' }

$ mcclient getData QmZDxgNgUT1J3rgjvnGjoxoA5efGNSN9Qvhq4FpvefmwnA
{ id: 'hello_1', hello: 'world' }
</code></pre>

<h2 id="going-public">Going Public</h2>

<p>In order to distribute statements stored in your node, it needs to become
discoverable and accessible to other nodes. This happens by taking the node
<code>public</code>, which registers with the directory.</p>

<p>Before you can take your node public however, you need to ensure that it is
reachable in the network. By default, <code>mcnode</code> binds its p2p interface in port 9001
for all interfaces, so if your node is directly connected to the Internet (eg in a vps
host), you don’t have to do anything.</p>

<p>However, chances are your node is behind a NAT and you will need to
<a href="/nat">configure it for NAT traversal</a>.</p>

<p>Once your node’s p2p port is reachable from the internet, you’re almost ready to take it
public.  As a final preparation for going public, you should add a short description
about your node and its contents:</p>

<pre><code>$ mcclient config info "Metadata from ...; Operated by ..."
</code></pre>

<p>Then your node should be ready to take it public:</p>

<pre><code>$ mcclient status public
</code></pre>

<p>This will register the node with the configured directory, which will make it visible
to other nodes through <code>mcclient listPeers</code>.</p>

<p>If you want to take your node back offline, you can simply do so with <code>status offline</code>:</p>

<pre><code>$ mcclient status offline
</code></pre>



                </div>
            </div>

            <div class="row">
                <div id="footer" class="col-sm-12">
                    <a href="http://images.mediachain.io">Attribution Engine</a>
<a class="pl12" href="http://slack.mediachain.io">Slack</a>
<a href="https://github.com/mediachain">Github</a>
<a href="https://blog.mediachain.io">Blog</a>
<a href="https://twitter.com/mediachain_">Twitter</a>

                </div>
            </div>
        </div>
        

        <script type="text/javascript">
          $(function() {
            var toc = $('#table_of_contents');
            if (toc != null) {
              $('#nav_current').append(toc);
              toc.toggle(true);
            }
          })
        </script>
    </body>
</html>
